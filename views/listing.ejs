<!DOCTYPE html>
<html>
<head>
   	<% include partials/head %>
    <title><%= address %> - <%= moment(startPeriod).format('MMM YYYY'); %></title>
</head>
<body>
  <% include partials/nav %>
  <div class="container">
    <h1><%= address %></h1>
    <div class="row">
      <div class="col-md-6 mb-3">
        <div id="listingPhotos" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <% for(let i = 0; i < imageLinks.length; i++) { %>
              <li data-target="#listingPhotos" data-slide-to="<%= i %>" class="<%= i == 0 ? 'active' : '' %>"></li>
            <% } %>
          </ol>
          <div class="carousel-inner">
            <% for(let i = 0; i < imageLinks.length; i++) { %>
              <div class="carousel-item <%= i == 0 ? 'active' : '' %>">
                <img class="d-block w-100" src="<%= imageLinks[i] %>">
              </div>
            <% } %>
          </div>
          <a class="carousel-control-prev" href="#listingPhotos" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#listingPhotos" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <ul class="list-group">
          <li class="list-group-item">Price: <%= price %></li>
          <li class="list-group-item">Address: <%= address %></li>
          <li class="list-group-item">Type: <%= saleType %></li>
          <li class="list-group-item">Rental Period: Winter Quarter</li>
          <li class="list-group-item">Preferred roommate: <b>Female</b></li>
          <li class="list-group-item">Occupants: # people</li>
          <li class="list-group-item">Vacancies: # </li>
          <% if (!isOwner) { %>
            <li class="list-group-item"><a href="mailto:seller@example.com" target="_top">Contact Seller</a>
          <% } else { %>
            <!-- TODO: Ask for confirmation before deleting. -->
            <li class="list-group-item">No longer available? <a href="#" id="delete-listing">Remove this listing.</a></li>
          <% } %>
        </a>
        </li>
        </ul>
      </div>
    </div>

    <main>
      <p><%= blurb %></p>
      <h2>More Details</h2>
      <div class="row">
        <div class="col-md-4">
          <p>Apartment Size: XXXX square feet</p>
          <p># of Bedrooms: <%= beds ? beds : 'Unknown' %></p>
          <p># of Baths: <%= baths ? baths : 'Unknown' %></p>
        </div>
        <div class="col-md-4">
          <p>Utilities Included: <%= utilities.length > 0 ? utilities.join(', ') : 'None' %></p>
          <p>Parking Available: <%= parking ? parking : 'Unknown' %><%= parkingCost ? (', $' + parkingCost) : '' %></p>
          <p>Smoking:
            <% if (smoking !== undefined) { %>
              <%= smoking ? 'Yes' : 'No' %>
            <% } else { %>
              Unknown
            <% } %>
          </p>
        </div>
        <div class="col-md-4">
          <p>Pets: <%= petsCost ? ('$' + petsCost) : 'No' %></p>
          <p><a href="#">Visit Website</a></p>
        </div>
      </div>
    </main>
  </div>

  <% include partials/scripts %>
  <script type="text/javascript">
    $('#delete-listing').click(function() {
      console.log('clicked');
      $.ajax({
        type: 'delete',
        url: '/listing/<%= id %>',
        success: function(response) {
          window.location.href = '/user'
        },
        error: function(jqXHR, status, err) {
          // TODO: Handle error adding to database.
        },
      });
    });
  </script>
</body>
</html>
