<!DOCTYPE html>
<html>
<head>
   	<% include partials/head %>
    <title><%= address %> - <%= moment(startPeriod).format('MMM YYYY'); %></title>
</head>
<body>
  <% include partials/nav %>
  <div class="container">
    <h1><%= address %></h1>
    <div class="row">
      <div class="col-md-6 mb-3">
        <div id="listingPhotos" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#listingPhotos" data-slide-to="0" class="active"></li>
            <li data-target="#listingPhotos" data-slide-to="1"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
              <img class="d-block w-100" src="https://cdn.decoist.com/wp-content/uploads/2016/06/Smart-and-modern-kitchen-inside-the-small-Vancouver-apartment.jpg">
            </div>
            <div class="carousel-item">
              <img class="d-block w-100" src="https://www.minorhotels.com/~/media/minor/oaks/images/australia/south-australia/adelaide/embassy/600x400/3-bedroom-executive-apartment/oaks-embassy-3-bedroom-executive-apartment-bed-3.jpg">
            </div>
          </div>
          <a class="carousel-control-prev" href="#listingPhotos" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#listingPhotos" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>

      <div class="col-md-6 mb-3">
        <ul class="list-group">
          <li class="list-group-item">Price: <%= price %></li>
          <li class="list-group-item">Address: <%= address %></li>
          <li class="list-group-item">Type: <%= saleType %></li>
          <li class="list-group-item">Available Starting: <%= moment(startPeriod).format('MMM YYYY'); %></li>
          <li class="list-group-item">Preferred gender:
            <% if (genderPreferred == 'male') { %>
              <b>Male</b>
            <% } else if (genderPreferred == 'female') { %>
              <b>Female</b>
            <% } else if (genderPreferred == 'other') { %>
              <b>Other (See description or contact owner)</b>
            <% } else { %>
              <b>No preference</b>
            <% } %>
            <b>Female</b></li>
          <% if (saleType == 'sublet') { %>
            <li class="list-group-item"># of Existing Occupants: <%= occupants ? occupants : 'Not Specified' %></li>
            <li class="list-group-item">Vacancies: <%= vacancies ? vacancies : 'Not Specified' %></li>
          <% } %>
          <% if (!isOwner) { %>
            <li class="list-group-item"><a href="mailto:seller@example.com" target="_top">Contact Seller</a>
          <% } else { %>
            <!-- TODO: Ask for confirmation before deleting. -->
            <li class="list-group-item">No longer available? <a href="#" id="delete-listing">Remove this listing.</a></li>
          <% } %>
        </a>
        </li>
        </ul>
      </div>
    </div>

    <main>
      <p><%= blurb %></p>
      <h2>More Details</h2>
      <div class="row">
        <div class="col-md-4">
          <p>Apartment Size: XXXX square feet</p>
          <p># of Bedrooms: <%= beds ? beds : 'Unknown' %></p>
          <p># of Baths: <%= baths ? baths : 'Unknown' %></p>
        </div>
        <div class="col-md-4">
          <p>Utilities Included: <%= utilities.length > 0 ? utilities.join(', ') : 'None' %></p>
          <p>Parking Available: <%= parking ? parking : 'Unknown' %><%= parkingCost ? (', $' + parkingCost) : '' %></p>
          <p>Smoking:
            <% if (smoking !== undefined) { %>
              <%= smoking ? 'Yes' : 'No' %>
            <% } else { %>
              Unknown
            <% } %>
          </p>
        </div>
        <div class="col-md-4">
          <p>Pets: <%= petsCost ? ('$' + petsCost) : 'No' %></p>
          <p><a href="#">Visit Website</a></p>
        </div>
      </div>
    </main>
  </div>

  <% include partials/scripts %>
  <script type="text/javascript">
    $('#delete-listing').click(function() {
      console.log('clicked');
      $.ajax({
        type: 'delete',
        url: '/listing/<%= id %>',
        success: function(response) {
          window.location.href = '/user'
        },
        error: function(jqXHR, status, err) {
          // TODO: Handle error adding to database.
        },
      });
    });
  </script>
</body>
</html>
